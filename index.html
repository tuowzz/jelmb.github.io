<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>เจลล้างหน้า 50ml | ล้างรองพื้น/คอนซีลเลอร์ได้หมดจด | อ่อนโยน ผิวแพ้ง่ายใช้ได้ | ส่งฟรี เก็บปลายทาง</title>
  <meta name="description" content="เจลล้างหน้า 50ml สูตรอ่อนโยน pH-balanced ล้างรองพื้น คอนซีลเลอร์ และกันแดดได้หมดจด ไม่ทำให้ผิวแห้งตึง เหมาะกับผิวแพ้ง่าย ลดสิวอุดตัน ส่งฟรี เก็บเงินปลายทาง (199/379/549/929)" />
  <meta name="keywords" content="เจลล้างหน้า, เจลล้างหน้าผิวแพ้ง่าย, เจลล้างหน้าล้างเครื่องสำอาง, ล้างรองพื้น, ล้างคอนซีลเลอร์, pH balance, อ่อนโยน" />
  <link rel="canonical" href="https://tuowzz.github.io/mbshopz.github.io/gel-cleanser" />

  <!-- Facebook Pixel -->
  <script>
    !function(f,b,e,v,n,t,s){
      if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '127978927946856');
    fbq('track', 'PageView');
    fbq('track', 'ViewContent');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=127978927946856&ev=PageView&noscript=1"/>
  </noscript>

  <!-- TikTok Pixel -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t;
      var ttq = w[t] = w[t] || [];
      ttq.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie"];
      ttq.setAndDefer = function (t, e) { t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } };
      for (var i = 0; i < ttq.methods.length; i++) { ttq.setAndDefer(ttq, ttq.methods[i]) }
      ttq.instance = function (t) { for (var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++) { ttq.setAndDefer(e, ttq.methods[n]) } return e };
      ttq.load = function (e, n) {
        var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i = ttq._i || {};
        ttq._i[e] = [];
        ttq._i[e]._u = i;
        ttq._t = ttq._t || {};
        ttq._t[e] = +new Date;
        ttq._o = ttq._o || {};
        ttq._o[e] = n || {};
        var o = document.createElement("script");
        o.type = "text/javascript";
        o.async = !0;
        o.src = i + "?sdkid=" + e + "&lib=" + t;
        var a = document.getElementsByTagName("script")[0];
        a.parentNode.insertBefore(o, a)
      };
      ttq.load('D0EVS2JC77U9C23772EG');
      ttq.page();
      ttq.track('ViewContent');
    }(window, document, 'ttq');
  </script>

  <!-- Google Ads (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17035064059"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-17035064059');
  </script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root {
      /* โทนม่วงพาสเทล */
      --primary: #9b7ede;
      --primary-strong: #7a5ccf;
      --light: #f8f5ff;
      --bg: #faf9fc;
      --white: #fff;
      --border: #ece7ff;
      --shadow: 0 4px 18px rgba(24,16,52,.08);
    }

    body { font-family: 'Kanit', sans-serif; margin:0; background:var(--bg); color:#161823; padding-bottom:75px; }
    .wrap { max-width: 430px; margin: 0 auto; }

    /* Header & badges */
    header h1 { font-size:1.18rem; line-height:1.5; color:var(--primary-strong); padding:14px; text-align:center; margin:0; }
    .badge { display:inline-block; background:var(--primary); color:#fff; font-size:.92rem; font-weight:700; border-radius:6px; padding:3px 8px; margin:0 6px 6px 0; }
    .badge.gray{ background:#2e2e2e; }

    .trust { background:var(--light); color:var(--primary-strong); text-align:center; font-weight:700; font-size:1.02rem; padding:10px 8px; border-top:1px solid var(--border); border-bottom:1px solid var(--border); }

    .card { background:var(--white); border-radius:14px; box-shadow:var(--shadow); margin:10px 10px; padding:14px 16px; }

    .gallery img { width:100%; max-width:360px; display:block; margin:0 auto; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,.08); border:1px solid var(--border); }

    .price { display:flex; align-items:center; justify-content:center; gap:12px; }
    .price .now { color:var(--primary-strong); font-size:2.0rem; font-weight:800; }
    .price .was { color:#b5b5b5; text-decoration:line-through; font-size:1.05rem; }

    .title { text-align:center; color:var(--primary); font-weight:600; font-size:1.1rem; margin-top:10px; }

    .pack-box { background:#fbf9ff; border:1px solid var(--border); border-radius:12px; padding:10px 12px; }
    .options { display:flex; flex-wrap:wrap; gap:9px; margin-top:8px; }
    .btn-option { border:2px solid #eee; background:#fff; color:var(--primary-strong); border-radius:10px; padding:8px 12px; font-weight:700; cursor:pointer; transition:.15s; }
    .btn-option:hover { border-color:var(--primary); }
    .btn-option.active { background:#f0eaff; border-color:var(--primary); box-shadow:0 1px 7px #cbb7ff44; }

    .scarcity { background:#f7f0ff; border:1.5px dashed var(--primary); color:var(--primary-strong); text-align:center; border-radius:10px; padding:10px; font-weight:700; }

    .shop { display:flex; gap:12px; align-items:center; }
    .shop .avatar { width:48px; height:48px; border-radius:50%; background:linear-gradient(135deg,#9b7ede,#b69bff); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; }
    .btn-line { display:flex; align-items:center; justify-content:center; gap:10px; background:#06c755; color:#fff; font-weight:700; border:none; border-radius:10px; padding:13px 16px; text-decoration:none; cursor:pointer; box-shadow:0 2px 10px rgba(6,199,85,.1); }

    .features .row { display:flex; gap:10px; align-items:center; margin:10px 0; }
    .features .icon { color:var(--primary-strong); font-size:1.2rem; }

    .video { text-align:center; }
    .video video { max-width:360px; width:100%; border-radius:14px; box-shadow:0 2px 12px rgba(0,0,0,.08); }

    /* Footer bar */
    .sticky { position:fixed; bottom:0; left:0; right:0; background:#fff; border-top:1px solid var(--border); height:64px; display:flex; z-index:50; }
    .sticky .btn-line { width:38%; border-radius:0; }
    .sticky .btn-buy { width:62%; border:none; background:var(--primary); color:#fff; font-weight:800; font-size:1.15rem; cursor:pointer; }

    /* Modal */
    .overlay { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; z-index:3000; }
    .modal { position:fixed; left:0; right:0; bottom:0; background:#fff; border-radius:18px 18px 0 0; box-shadow:var(--shadow); padding:18px 14px; max-height:92vh; overflow:auto; z-index:3001; transform:translateY(22px); animation:slideUp .22s ease forwards; }
    @keyframes slideUp { to { transform:translateY(0); } }
    .x { position:absolute; right:16px; top:10px; color:#999; font-size:1.6rem; cursor:pointer; }
    .modal .head { display:flex; gap:12px; align-items:center; border-bottom:1px solid #f0eefc; padding-bottom:10px; margin-bottom:10px; }
    .modal .head img { width:66px; height:66px; border-radius:10px; border:1px solid var(--border); object-fit:cover; }
    .m-title { font-weight:600; font-size:1.05rem; }
    .m-price { color:var(--primary-strong); font-size:1.26rem; font-weight:800; }
    .form label { display:block; font-weight:600; margin:10px 0 6px; }
    .form input, .form textarea { width:100%; border:1px solid #ddd; border-radius:9px; padding:11px; font-size:1.02rem; font-family:'Kanit', sans-serif; }
    .submit { width:100%; background:var(--primary); color:#fff; border:none; border-radius:10px; padding:14px; font-weight:800; font-size:1.05rem; margin-top:12px; cursor:pointer; box-shadow:0 1px 10px rgba(155,126,222,.25); }
    .submit:disabled { background:#d6c9ff; cursor:not-allowed; }

    /* Sales Toast */
    #salesToastContainer { position:fixed; left:12px; bottom:84px; z-index:5000; }
    .toast { display:flex; gap:10px; align-items:center; background:#fff; border:1px solid #e9e4ff; box-shadow:0 6px 22px rgba(0,0,0,.08); border-radius:12px; padding:10px 12px; min-width:260px; max-width:320px; animation:toastSlide .28s ease-out; }
    .toast .av { width:40px; height:40px; border-radius:50%; background:#f0eaff; display:flex; align-items:center; justify-content:center; font-weight:700; color:#7a5ccf; border:1px solid #d8cfff; }
    .toast .text { font-size:.94rem; line-height:1.25; color:#1e293b; }
    .toast .time { color:#64748b; font-size:.82rem; margin-top:2px; }
    .toast strong { color:#7a5ccf; }
    @keyframes toastSlide { from { transform: translateY(12px); opacity:0 } to { transform: translateY(0); opacity:1 } }

    /* Reviews */
    .reviews h3{ margin:0 0 10px 0; font-size:1.05rem; }
    .rev{ border-top:1px solid #f0eefc; padding-top:10px; margin-top:10px; }
    .rev:first-child{ border-top:none; padding-top:0; margin-top:0; }
    .rev-head{ display:flex; align-items:center; gap:8px; margin-bottom:6px; }
    .rev .stars{ color:#f9d71c; }
    .rev .author{ font-weight:600; font-size:.93rem; }
    .rev .text{ font-size:.97rem; line-height:1.46; color:#1f2937; }
    .rev .shots{ display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
    .rev .shots img{ width:220px; max-width:100%; border-radius:11px; border:1px solid #eee; }
    .rev .meta{ color:#9aa1ad; font-size:.9rem; margin-top:6px; }
    .seller-reply{ background:#fbf9ff; padding:8px 12px; border-radius:8px; margin-top:8px; font-size:.98rem; color:#6b6b6b; border:1px solid var(--border); }

    @media (max-width: 430px) { .card { margin:10px 8px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>
        <span class="badge">ขายดี</span>
        <span class="badge" style="background:#22c55e">ส่งฟรี</span>
        <span class="badge" style="background:#ffb300">พร้อมส่ง</span>
        <span class="badge gray">เก็บเงินปลายทาง</span><br/>
        <b>เจลล้างหน้า 50ml</b> | อ่อนโยน pH-balanced | <span style="color:var(--primary-strong)">ล้างรองพื้น/คอนซีลเลอร์/กันแดด</span>
      </h1>
    </header>

    <!-- วิดีโอแนะนำสินค้า ช่วงต้น -->
    <section class="card video">
      <video autoplay muted loop playsinline controls>
        <source src="intro_demo.mp4" type="video/mp4">ไม่สามารถเล่นวิดีโอนี้ได้
      </video>
      <div style="font-size:.93rem;color:#888;margin-top:6px">คลิปแนะนำสินค้า – วิธีใช้ และผลลัพธ์หลังล้าง</div>
    </section>

    <!-- แถบความน่าเชื่อถือ -->
    <div class="trust">✅ สูตรอ่อนโยน | ล้างเมคอัพได้หมดจด | ลดสิวอุดตัน | ส่งฟรีทั่วประเทศ | เก็บปลายทาง</div>

    <!-- แกลเลอรีภาพสินค้า -->
    <section class="card gallery">
      <img src="gel_main.jpg" alt="เจลล้างหน้า 50ml ล้างรองพื้น คอนซีลเลอร์">
    </section>

    <section style="padding:0 16px 6px;color:#7a7a7a;font-size:.95rem">#เจลล้างหน้า #เจลล้างหน้าผิวแพ้ง่าย #ล้างรองพื้น #ล้างคอนซีลเลอร์ #pHbalanced #อ่อนโยน</section>

    <!-- ราคา + แพ็ก -->
    <section class="card">
      <div class="price"><span class="now" id="priceNow">฿199</span><span class="was" id="priceWas">฿259</span></div>
      <div class="title">✨ เจลล้างหน้า 50ml อ่อนโยน ล้างรองพื้น/คอนซีลเลอร์ ได้สะอาดหมดจด</div>
      <div class="pack-box" style="margin-top:12px">
        <b>เลือกแพ็ก (เรทราคา):</b>
        <div class="options" id="packOptions"></div>
        <div id="packNote" style="font-size:.93rem;color:#6b6b6b;margin-top:6px">แพ็กเดี่ยว 1 หลอด เหมาะสำหรับทดลองใช้/พกพา</div>
      </div>
      <div class="scarcity" style="margin-top:12px">🎉 <b>โปรพิเศษ! สต็อกจำกัด</b> | ส่งฟรีวันนี้เท่านั้น</div>
    </section>

    <!-- ร้านค้า + ปุ่มไลน์ -->
    <section class="card shop">
      <div class="avatar">MB</div>
      <div style="flex:1">
        <div style="font-weight:700">Mblithe Official</div>
        <a href="https://lin.ee/wKelfsp" target="_blank" class="btn-line" id="btnLineTop"><i class="fa-brands fa-line"></i> สอบถาม-รับโปรผ่าน LINE</a>
      </div>
    </section>

    <!-- ฟีเจอร์สินค้า -->
    <section class="card features">
      <h3 style="margin:0 0 8px 0; font-size:1.05rem">รายละเอียดสินค้า</h3>
      <div class="row"><i class="fa-solid fa-droplet icon"></i> สูตรอ่อนโยน pH-balanced ผิวไม่เอี๊ยดตึง</div>
      <div class="row"><i class="fa-solid fa-wand-magic-sparkles icon"></i> ล้าง <b>รองพื้น/คอนซีลเลอร์/กันแดด</b> ได้หมดจด ลดโอกาสอุดตัน</div>
      <div class="row"><i class="fa-solid fa-leaf icon"></i> ปราศจากแอลกอฮอล์/พาราเบน/ซัลเฟต (SLS/SLES)</div>
      <div class="row"><i class="fa-solid fa-flask icon"></i> เหมาะกับผิวมัน/เป็นสิว/แพ้ง่าย ใช้ได้เช้า–เย็น</div>
      <div style="color:#9a9aa9;font-size:.9rem">* ผลลัพธ์อาจแตกต่างกันไปในแต่ละบุคคล</div>
    </section>

    <!-- รีวิวลูกค้าจริง (ตรงกลางเพจ) -->
    <section class="card reviews">
      <h3><i class="fa-solid fa-comments"></i> รีวิวจากลูกค้าจริง</h3>

      <div class="rev">
        <div class="rev-head"><span class="stars">⭐⭐⭐⭐⭐</span><span class="author">P**m</span></div>
        <p class="text">ล้างรองพื้นกับกันแดดออกเกลี้ยงมากค่ะ ผิวไม่เอี๊ยดตึง เหมาะกับผิวแพ้ง่ายสุด ๆ ใช้เช้า–เย็นแล้วไม่แห้ง</p>
        <div class="shots"><img src="review1.jpg" alt="รีวิวการใช้เจลล้างหน้า รูปที่ 1"></div>
        <div class="meta">02-09</div>
        <div class="seller-reply"><b>จากร้านค้า:</b><br>ขอบคุณสำหรับรีวิวค่ะ ดีใจที่ชอบความอ่อนโยนของสูตรนี้นะคะ 💜</div>
      </div>

      <div class="rev">
        <div class="rev-head"><span class="stars">⭐⭐⭐⭐⭐</span><span class="author">N**n</span></div>
        <p class="text">โฟมไม่เยอะ แต่สะอาดจริง หลังล้างหน้านุ่ม ไม่แห้งลอก ใช้ลบคอนซีลเลอร์ได้ด้วย ชอบมาก</p>
        <div class="shots">
          <img src="review2a.jpg" alt="รีวิวเจลล้างหน้า รูปที่ 2a">
          <img src="review2b.jpg" alt="รีวิวเจลล้างหน้า รูปที่ 2b">
        </div>
        <div class="meta">02-18</div>
      </div>

      <div class="rev">
        <div class="rev-head"><span class="stars">⭐⭐⭐⭐⭐</span><span class="author">M**</span></div>
        <p class="text">แพ็คดี ส่งไว ล้างกันแดดกันน้ำออกง่าย ไม่แสบหน้า กลิ่นสะอาด สดชื่น ใช้ต่อแน่นอน</p>
        <div class="shots">
          <img src="review3a.jpg" alt="รีวิวเจลล้างหน้า รูปที่ 3a">
          <img src="review3b.jpg" alt="รีวิวเจลล้างหน้า รูปที่ 3b">
        </div>
        <div class="meta">03-05</div>
      </div>
    </section>

    <!-- คลิปแพ็คของ ส่งของ (ท้ายเพจ) -->
    <section class="card video">
      <video autoplay muted loop playsinline controls>
        <source src="pack_ship.mp4" type="video/mp4">ไม่สามารถเล่นวิดีโอนี้ได้
      </video>
      <div style="font-size:.96rem;color:#7a7a7a;margin-top:6px">คลิปแพ็คของจริง + ส่งของทุกวัน จันทร์–เสาร์ 🚚</div>
    </section>
  </div>

  <!-- Sticky Footer -->
  <div class="sticky">
    <a href="https://lin.ee/wKelfsp" target="_blank" class="btn-line" id="btnLineBottom"><i class="fa-brands fa-line"></i> แอดไลน์รับโปร</a>
    <button class="btn-buy" id="btnBuy">สั่งซื้อเลย</button>
  </div>

  <!-- Modal & Overlay -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true"></div>
  <div class="modal" id="modal" style="display:none">
    <i class="fa-solid fa-times x" id="x"></i>
    <div class="head">
      <img src="gel_main.jpg" alt="เจลล้างหน้า 50ml">
      <div>
        <div class="m-title" id="mTitle">เจลล้างหน้า 50ml (แพ็กเดี่ยว 1 หลอด)</div>
        <div class="m-price" id="mPrice">฿199</div>
      </div>
    </div>

    <div style="margin-bottom:10px">
      <b>เลือกแพ็ก:</b>
      <div class="options" id="modalPacks"></div>
      <div id="mNote" style="font-size:.92rem;color:#777;margin-top:6px">แพ็กเดี่ยว 1 หลอด เหมาะสำหรับทดลองใช้/พกพา</div>
    </div>

    <form class="form" id="orderForm" onsubmit="submitOrder(event)">
      <!-- hidden fields for Sheets -->
      <input type="hidden" name="order_id" id="orderIdInput" />
      <input type="hidden" name="Order ID" id="orderIdAlias" />

      <input type="hidden" name="Product" id="productInput" />
      <input type="hidden" name="pack_id" id="packIdInput" />
      <input type="hidden" name="pack_label" id="packLabelInput" />

      <!-- price/qty + aliases -->
      <input type="hidden" name="amount" id="amountInput" />
      <input type="hidden" name="price" id="priceInput" />
      <input type="hidden" name="qty" id="qtyInput" />
      <input type="hidden" name="total" id="totalInput" />
      <input type="hidden" name="total_price" id="totalPriceInput" />
      <input type="hidden" name="ยอดรวม" id="thaiTotalInput" />
      <input type="hidden" name="ราคา" id="thaiPriceInput" />
      <input type="hidden" name="cod_amount" id="codAmountInput" />

      <!-- display columns -->
      <input type="hidden" name="Label" id="labelAlias" />
      <input type="hidden" name="หมายเหตุ" id="noteAlias" />

      <label for="name">ชื่อ-นามสกุล</label>
      <input id="name" name="Name" type="text" required placeholder="กรอกชื่อ-นามสกุล" />
      <label for="phone">เบอร์โทรศัพท์</label>
      <input id="phone" name="Phone" type="text" required placeholder="ตัวอย่าง: 0812345678" pattern="^[0-9]{10}$" title="กรอกเบอร์โทรศัพท์ 10 หลัก" />
      <label for="address">ที่อยู่จัดส่ง</label>
      <textarea id="address" name="Address" rows="3" required placeholder="บ้านเลขที่, ถนน, ตำบล, อำเภอ, จังหวัด, รหัสไปรษณีย์"></textarea>
      <div style="font-size:12px;color:#666;margin-top:4px">ข้อมูลของคุณจะถูกใช้เพื่อการยืนยันคำสั่งซื้อและจัดส่งสินค้าเท่านั้น และจะถูกเก็บรักษาตามมาตรการ PDPA ของเรา</div>
      <button type="submit" class="submit" id="submitBtn">ยืนยันสั่งซื้อ</button>
    </form>
  </div>

  <!-- Success Toast Popup -->
  <div id="salesToastContainer"></div>

  <!-- Success Modal (simple) -->
  <div id="ok" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:4000; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:16px; padding:22px 28px; text-align:center; box-shadow:var(--shadow); max-width:320px;">
      <div style="font-size:2.2rem;color:#16cf3b; margin-bottom:6px"><i class="fa-solid fa-circle-check"></i></div>
      <div style="font-weight:800; font-size:1.08rem; color:#1f2937">สั่งซื้อสำเร็จ!</div>
      <div style="font-size:.98rem; color:#6b7280; margin-top:6px">เจ้าหน้าที่จะติดต่อกลับเพื่อยืนยันออเดอร์</div>
    </div>
  </div>

<script>
  // ===== CONFIG =====
  const GOOGLE_SHEET_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzBFS1zxkrbiOpcP-1wYxALRfU3wJprPRT9KJju2wWEY2Rdd7OnJbFDTCErH-amUZrO/exec';

  // แพ็ก (เรทราคา): 199 / 379 / 549 / 929
  const PACKS = [
    { id:'P1', qty:1, label:'แพ็กเดี่ยว 1 หลอด', price:199, compareAt:259, note:'เหมาะสำหรับทดลองใช้/พกพา' },
    { id:'P2', qty:2, label:'แพ็กคุ้มค่า 2 หลอด', price:379, compareAt:518, note:'ประหยัดกว่า ตกหลอดละ ~189.5฿' },
    { id:'P3', qty:3, label:'แพ็กประหยัด 3 หลอด', price:549, compareAt:777, note:'คุ้มสุดต่อบิล ตกหลอดละ ~183฿' },
    { id:'P5', qty:5, label:'แพ็กครอบครัว 5 หลอด', price:929, compareAt:1295, note:'ประหยัดยกเซ็ต ตกหลอดละ ~185.8฿' },
  ];

  let selectedPack = PACKS[0];

  // ===== Utility =====
  const $ = sel => document.querySelector(sel);
  const $$ = sel => document.querySelectorAll(sel);
  const money = n => '฿' + Number(n).toLocaleString('th-TH');

  // ===== Render pack buttons =====
  function renderPacks(){
    const host1 = $('#packOptions');
    const host2 = $('#modalPacks');
    host1.innerHTML = ''; host2.innerHTML = '';
    PACKS.forEach(p=>{
      const mk = (inModal=false)=>{
        const b = document.createElement('button');
        b.type='button'; b.className='btn-option'; b.textContent=p.label; b.dataset.id=p.id;
        b.onclick=()=>selectPack(p.id);
        return b;
      };
      host1.appendChild(mk(false));
      host2.appendChild(mk(true));
    });
    selectPack(selectedPack.id);
  }

  function selectPack(id){
    selectedPack = PACKS.find(x=>x.id===id) || PACKS[0];
    // toggle active
    $$('#packOptions .btn-option').forEach(b=>b.classList.toggle('active', b.dataset.id===selectedPack.id));
    $$('#modalPacks .btn-option').forEach(b=>b.classList.toggle('active', b.dataset.id===selectedPack.id));
    // update price text
    $('#priceNow').textContent = money(selectedPack.price);
    $('#priceWas').textContent = money(selectedPack.compareAt);
    $('#mPrice').textContent = money(selectedPack.price);
    $('#mTitle').textContent = `เจลล้างหน้า 50ml (${selectedPack.label})`;
    $('#packNote').textContent = selectedPack.note;
    $('#mNote').textContent = selectedPack.note;

    // hidden fields (ให้ตรงหัวคอลัมน์ชีต)
    const priceStr = String(selectedPack.price);
    const qtyStr = String(selectedPack.qty);

    $('#orderIdInput').value = '';
    $('#orderIdAlias').value = '';

    $('#productInput').value = `Gel Cleanser 50ml - ${selectedPack.label}`; // Product (P ใหญ่)
    $('#packIdInput').value = selectedPack.id;
    $('#packLabelInput').value = selectedPack.label;

    $('#amountInput').value = priceStr;
    $('#priceInput').value  = priceStr;
    $('#qtyInput').value    = qtyStr;
    $('#totalInput').value       = priceStr;
    $('#totalPriceInput').value  = priceStr;
    $('#thaiTotalInput').value   = priceStr;
    $('#thaiPriceInput').value   = priceStr;
    $('#codAmountInput').value   = priceStr;

    // labels (จะแนบอีกทีตอน submit)
    $('#labelAlias').value = `COD: ${money(selectedPack.price)} • ${selectedPack.label}`;
    $('#noteAlias').value  = `ราคา ${money(selectedPack.price)} / Qty ${selectedPack.qty}`;
  }

  // ===== Modal control =====
  const openModal = () => {
    $('#overlay').style.display='block';
    $('#modal').style.display='block';
    if (window.fbq) fbq('track', 'InitiateCheckout', {value:selectedPack.price, currency:'THB'});
    if (window.ttq) ttq.track('InitiateCheckout');
    if (window.gtag) gtag('event','begin_checkout',{value:selectedPack.price, currency:'THB'});
  };
  const closeModal = () => { $('#overlay').style.display='none'; $('#modal').style.display='none'; };
  $('#btnBuy').addEventListener('click', openModal);
  $('#x').addEventListener('click', closeModal);
  $('#overlay').addEventListener('click', closeModal);

  // ===== LINE tracking =====
  function trackLine(){ if(window.fbq) fbq('track','Contact'); if(window.ttq) ttq.track('Contact'); }
  $('#btnLineTop').addEventListener('click', trackLine);
  $('#btnLineBottom').addEventListener('click', trackLine);

  // ===== Order submit =====
  async function submitOrder(e){
    e.preventDefault();
    const btn = $('#submitBtn');
    btn.disabled = true; btn.textContent = 'กำลังส่งข้อมูล...';

    const formEl = $('#orderForm');

    // sync ข้อมูลล่าสุดอีกครั้งก่อนส่ง
    selectPack(selectedPack.id);

    const fd = new FormData(formEl);

    // สร้าง Order ID และ map ให้เข้ากับหัวคอลัมน์จริง
    const _orderId = 'ORD-' + Date.now();
    fd.set('order_id', _orderId);
    fd.set('Order ID', _orderId);
    try { $('#orderIdInput').value = _orderId; $('#orderIdAlias').value = _orderId; } catch(_){}

    // กันเบอร์โทรถูก format เป็นตัวเลขในชีต (ใส่ ' นำหน้า)
    const phone = $('#phone').value || '';
    if (phone && !phone.startsWith("'")) fd.set('Phone', "'"+phone);

    // product + price/qty (คีย์หลัก)
    fd.set('Product', `Gel Cleanser 50ml - ${selectedPack.label}`);
    fd.set('amount', String(selectedPack.price));
    fd.set('price',  String(selectedPack.price));
    fd.set('qty',    String(selectedPack.qty));
    fd.set('pack_label', selectedPack.label);

    // aliases (บางสคริปต์ใช้ชื่อคอลัมน์ต่างกัน)
    fd.set('total',        String(selectedPack.price));
    fd.set('total_price',  String(selectedPack.price));
    fd.set('ยอดรวม',        String(selectedPack.price));
    fd.set('ราคา',          String(selectedPack.price));
    fd.set('cod_amount',   String(selectedPack.price));

    // คอลัมน์สำหรับอ่านง่ายในชีต
    const _label = `COD: ${money(selectedPack.price)} • ${selectedPack.label}`;
    const _note  = `ราคา ${money(selectedPack.price)} / Qty ${selectedPack.qty}`;
    fd.set('Label', _label);
    fd.set('หมายเหตุ', _note);

    // DEBUG: log ค่าที่ส่ง
    try { const entries = []; fd.forEach((v,k)=>entries.push(`${k}=${v}`)); console.log('[ORDER FORMSENT]', entries.join('&')); } catch(_){}

    try{
      const res = await fetch(GOOGLE_SHEET_WEB_APP_URL, { method:'POST', body: fd });
      const data = await res.json();
      if(data.result==='success'){
        closeModal(); formEl.reset();
        // Pixels purchase
        if(window.fbq) fbq('track','Purchase',{value:selectedPack.price, currency:'THB'});
        if(window.ttq) ttq.track('CompletePayment',{contents:[{content_id:'GEL-50ML',content_type:'product',quantity:selectedPack.qty}], value:selectedPack.price, currency:'THB'});
        if(window.gtag) gtag('event','conversion',{'send_to':'AW-17035064059/53zPCNHE2OIaEPvl-bo_','value':selectedPack.price,'currency':'THB'});
        // Success UI
        showOk();
        showSaleToast({ name: ($('#name').value||'ลูกค้า'), pack:selectedPack.label, price:selectedPack.price });
      } else {
        alert('เกิดข้อผิดพลาด: ' + (data.message||'ไม่ทราบสาเหตุ'));
      }
    }catch(err){
      alert('เกิดข้อผิดพลาดในการส่งข้อมูล: ' + err.message);
      console.error(err);
    } finally {
      btn.disabled = false; btn.textContent = 'ยืนยันสั่งซื้อ';
    }
  }

  function showOk(){
    const box = $('#ok'); box.style.display='flex'; setTimeout(()=> box.style.display='none', 2200);
  }

  // ===== Sales Toast (ป๊อปอัพเด้งว่ามีคนสั่งซื้อ) =====
  const NAMES = ['เอม','นัท','โบว์','กวาง','ปอ','ออย','กิ๊ฟ','มาย','เบส','พิม','นิว','อิง','ก้อง','น้ำผึ้ง','ก้อย'];
  const PROVINCES = ['กรุงเทพฯ','นนทบุรี','ปทุมธานี','ชลบุรี','เชียงใหม่','ขอนแก่น','นครราชสีมา','ภูเก็ต','สงขลา','นครปฐม'];
  const maskName = n => (n? (n.trim()[0]||'ลูกค้า') + (n.length>1?'**':'*') : 'ลูกค้า');

  function showSaleToast({name, pack, price, province}){
    const c = document.getElementById('salesToastContainer'); if(!c) return;
    const el = document.createElement('div'); el.className='toast';
    const av = document.createElement('div'); av.className='av'; av.textContent='MB';
    const text = document.createElement('div'); text.className='text';
    const who = maskName(name || NAMES[Math.floor(Math.random()*NAMES.length)]);
    const where = province || PROVINCES[Math.floor(Math.random()*PROVINCES.length)];
    text.innerHTML = `<div><strong>${who}</strong> เพิ่งสั่ง <strong>${pack}</strong> ${money(price)}</div><div class="time">จาก ${where} • เมื่อสักครู่</div>`;
    el.appendChild(av); el.appendChild(text); c.appendChild(el);
    setTimeout(()=>{ el.style.transition='opacity .25s'; el.style.opacity='0'; setTimeout(()=>el.remove(), 260); }, 5200);
  }

  function scheduleFakeToast(){
    const p = PACKS[Math.floor(Math.random()*PACKS.length)];
    showSaleToast({
      name: NAMES[Math.floor(Math.random()*NAMES.length)],
      pack: p.label,
      price: p.price,
      province: PROVINCES[Math.floor(Math.random()*PROVINCES.length)]
    });
    const next = 16000 + Math.floor(Math.random()*14000); // 16–30s
    setTimeout(scheduleFakeToast, next);
  }

  // ===== Init =====
  renderPacks();
  setTimeout(scheduleFakeToast, 4000);
</script>
</body>
</html>
